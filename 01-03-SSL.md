# OpenSSL & keytool

* OpenSSL包含三个部分SSL协议库libssl、应用程序命令工具以及密码算法库libcrypto。使用标准格式（PEM/CER/CRT/PKCS等）储存密钥和证书信息。
* keytool是Java体系的密钥和证书管理工具，使用KeyStore来管理密钥和证书。另外还有与KeyStore一样文件格式的truststore，用来保存一些可信任的证书,以便https被访问时，确保可信任。

## OpenSSL

### 简介

#### 功能

1. 对称加密算法：流加密算法-RC4，分组加密算法-AES、DES、Blowfish、CAST、IDEA、RC2、RC5。
2. 非对称加密算法：DH算法、RSA算法、DSA算法、椭圆曲线算法（EC）。RSA算法可可以用于密钥交换，也可用于数字签名。
3. 信息摘要算法：MD2、MD5、MDC2、SHA（SHA1）、RIPEMD。
4. 秘钥和证书管理：

   * 提供对证书、公钥、私钥、证书请求以及CRL等数据对象的DER、PEM和BASE64的编解码功能。
   * 提供对公钥和私钥的DER编解码功能。
   * 实现私钥的PKCS#12和PKCS#8的编解码功能。
   * 实现证书的X.509标准编解码、PKCS#12格式的编解码以及PKCS#7的编解码功能。
   * 提供的CA应用程序就是一个小型的证书管理中心，实现证书签发的整个流程和证书管理的大部分机制。

#### AES加解密

对称加密需要使用的标准命令为 enc。

* -in filename：指定要加密的文件存放路径。
* -out filename：指定加密后的文件存放路径。
* -salt：自动插入一个随机数作为文件内容加密，默认选项。
* -e：可以指明一种加密算法，若不指的话将使用默认加密算法。
* -d：解密，解密时也可以指定算法，若不指定则使用默认算法，但一定要与加密时的算法一致。
* -a/-base64：使用-base64位编码格式。

```bash
# 加密
[root ~]# openssl enc -e -des3 -a -in in.txt -out out.enc
enter des-ede3-cbc encryption password:  #输入密码
Verifying - enter des-ede3-cbc encryption password:  #再次输入密码
# 解密
root ~]# openssl enc -d -des3 -a -in out.enc -out in.txt
enter des-ede3-cbc decryption password:  #输入密码
```

### RSA秘钥生成

默认产生的公钥、私钥都是PEM格式的。

1. 生成RSA私钥、公钥

```bash
# 生成明文秘钥对
[root ~]# openssl genrsa -out rsa_private.pem 2048
# 从秘钥对中导出公钥
[root ~]# openssl rsa -in rsa_private.key -pubout -out rsa_public.key
```

2. 生成AES加密的秘钥对

```bash
# 生成密文秘钥对
[root ~]# openssl genrsa -aes256 -passout pass:111111 -out rsa_aes_private.key 2048
# 从秘钥对中导出明文公钥
[root ~]# openssl rsa -in rsa_aes_private.key -passin pass:111111 -pubout -out rsa_public.key
# 解密秘钥对
[root ~]# openssl rsa -in rsa_aes_private.key -passin pass:111111 -out rsa_private.key
```

3. PEM转DER

```bash
[root ~]# rsa -in rsa_private.key -outform der -out rsa_private.der 
```

4. 私钥PKCS#1转PKCS#8

rsa 默认是传统私钥格式PKCS#1，可以将PKCS#1转换为PKCS#8格式，pkcs8默认采用 des3 加密算法，可使用 -nocrypt 参数可以输出无加密的pkcs8密钥。

```bash
# rsa转PKCS#8
[root ~]# openssl pkcs8 -topk8 -in rsa_private.key -passout pass:111111 -out pkcs8_private.key
# 导出无加密PKCS#8
[root ~]# openssl pkcs8 -topk8 -in rsa_private.key -nocrypt -out nocrypt_pkcs8_private.key
```

5. 生成CA证书

-new指生成证书请求，加上-x509 表示直接输出证书

```bash
# 同时生成RSA私钥和自签名证书
[root ~]# openssl req -newkey rsa:2048 -nodes -keyout rsa_private.key -x509 -days 365 -out cert.crt
# 使用 已有RSA 私钥生成自签名证书
[root ~]# openssl req -new -x509 -days 365 -key rsa_private.key -out cert.crt
```

6. 生成签名请求，使用请求发送给CA机构签发证书

```bash
# 生成CSR签名请求
[root ~]# openssl req -new -key rsa_private.key  -out server.csr
```

7， 使用 CA 证书及CA密钥 对请求签发证书进行签发，生成 x509证书

```bash
# 使用自签名的CA证书及CA秘钥，对请求签发证书进行签发，x509证书和秘钥就可以使用到nginx等服务器
[root ~]# openssl x509 -req -days 3650 -in server.csr -CA cert.crt -CAkey rsa_private.key -passin pass:111111 -CAcreateserial -out server.crt
# 使用CA根证书对我们签发的x509证书进行校验
[root ~]# openssl verify -CAfile cert.crt server.crt 
server.crt: OK
# 转换证书编码格式
[root ~]# openssl x509 -in cert.crt -inform PEM -outform DER -out cert.der
# pem 证书和私钥转 pkcs#12 证书
[root ~]# openssl pkcs12 -export -in server.crt -inkey server.key -passin pass:111111 -password pass:111111 -out server.p12
# pem 证书和私钥/CA 证书 合成pkcs#12 证书
[root ~]#  openssl pkcs12 -export -in server.crt -inkey server.key -passin pass:111111 -chain -CAfile cert.crt -password pass:111111 -out server-all.p12
```

# 对称加密

## 常见的对称加密算法


| 算法                                | 描述                                                                 |
| ----------------------------------- | -------------------------------------------------------------------- |
| DES（Data Encryption Standard）     | 数据加密标准，速度较快，适用于加密大量数据                           |
| 3DES（Triple DES）                  | 基于DES，对一块数据用三个不同的密钥进行三次加密，强度更高            |
| AES（Advanced Encryption Standard） | 高级加密标准，速度快，安全级别高，支持128、192、256、512位密钥的加密 |
