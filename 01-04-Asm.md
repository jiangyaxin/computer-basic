# Class文件结构

class文件 使用 u1、u2、u4 表示1、2、4字节无符号整数，用table来表示数组对象，table由长度n+n个字节数组组成，一个字节数组就是一个对象。

```text
ClassFile {
    u4             magic;                                    //Class 文件的标志：魔数
    u2             minor_version;                            //Class 的次版本号
    u2             major_version;                            //Class 的主版本号
    u2             constant_pool_count;                      //常量池的数量
    cp_info        constant_pool[constant_pool_count-1];     //常量池
    u2             access_flags;                             //Class 的访问标志
    u2             this_class;                               //当前类
    u2             super_class;                              //父类
    u2             interfaces_count;                         //接口
    u2             interfaces[interfaces_count];             //一个类可以实现多个接口
    u2             fields_count;                             //Class 文件的字段属性
    field_info     fields[fields_count];                     //一个类会可以有个字段
    u2             methods_count;                            //Class 文件的方法数量
    method_info    methods[methods_count];                   //一个类可以有个多个方法
    u2             attributes_count;                         //此类的属性表中的属性数
    attribute_info attributes[attributes_count];             //属性表集合
}
```

`My Very Cute Animal Turns Savage In Full Moon Areas`
![438.png](assets/438.png)

## 常量池

常量池的索引从1开始，第0项是用于表示“不引用任何一个常量池项目”。

```text
cp_info {
    u1 tag;     // 常量项类型
    u1 info[];  // 字节数组
}
```

不同的常量类型字节数组布局不一样。

<table>
    <tr>
        <td>类型</td>
        <td>描述</td>
        <td>类型</td>
        <td>字段</td>
        <td>备注</td>
   </tr>
    <tr>
  		 <td rowspan="3">CONSTANT_utf8_info</td>
  		 <td rowspan="3">MUTF8编码的字符串</td>
         <td>u1</td>
         <td>tag</td>
         <td>1</td>
    </tr>
    <tr>
        <td>u2</td>  
        <td>length</td>
        <td>长度</td>
    </tr>
    <tr>
        <td>u1</td>  
        <td>byte[length]</td>
        <td>字节数组</td>
    </tr>
    <tr>
  		 <td rowspan="2">CONSTANT_Integer_info</td>
  		 <td rowspan="2">整型字面量</td>
         <td>u1</td>
         <td>tag</td>
         <td>3</td> 
    </tr>
    <tr>
        <td>u4</td>  
        <td>byte[4]</td>
    </tr>
    <tr>
  		 <td rowspan="2">CONSTANT_Float_info</td>
  		 <td rowspan="2">浮点型字面量</td>
         <td>u1</td>
         <td>tag</td>
         <td>4</td> 
    </tr>
    <tr>
        <td>u4</td>  
        <td>byte[4]</td>
    </tr>
    <tr>
  		 <td rowspan="3">CONSTANT_Long_info</td>
  		 <td rowspan="3">长整型字面量</td>
         <td>u1</td>
         <td>tag</td>
         <td>5</td> 
    </tr>
    <tr>
        <td>u4</td>  
        <td>byte[4]</td>
        <td>高4位</td>
    </tr>
    <tr>
        <td>u4</td>  
        <td>byte[4]</td>
        <td>低4位</td>
    </tr>
    <tr>
  		 <td rowspan="3">CONSTANT_Double_info</td>
  		 <td rowspan="3">双精度浮点型字面量</td>
         <td>u1</td>
         <td>tag</td>
         <td>6</td> 
    </tr>
    <tr>
        <td>u4</td>  
        <td>byte[4]</td>
        <td>高4位</td>
    </tr>
    <tr>
        <td>u4</td>  
        <td>byte[4]</td>
        <td>低4位</td>
    </tr>
    <tr>
  		 <td rowspan="2">CONSTANT_Class_info</td>
  		 <td rowspan="2">类或接口的符号引用</td>
         <td>u1</td>
         <td>tag</td>
         <td>7</td> 
    </tr>
    <tr>
        <td>u2</td>  
        <td>name_index</td>
        <td>指向全限定名常量项的索引，CONSTANT_utf8_info</td>
    </tr>
    <tr>
  		 <td rowspan="2">CONSTANT_String_info</td>
  		 <td rowspan="2">字符串类型字面量</td>
         <td>u1</td>
         <td>tag</td>
         <td>8</td> 
    </tr>
    <tr>
        <td>u2</td>  
        <td>name_index</td>
        <td>指向字符串字面量的索引，CONSTANT_utf8_info</td>
    </tr>
    <tr>
  		 <td rowspan="3">CONSTANT_Fieldref_info</td>
  		 <td rowspan="3">字段的符号引用</td>
         <td>u1</td>
         <td>tag</td>
  		 <td>9</td> 
    </tr>
    <tr>
        <td>u2</td>  
        <td>class_index</td>
        <td>指向声明字段的类或者接口描述符，CONSTANT_Class_info</td>
    </tr>
    <tr>
        <td>u2</td>  
        <td>name_and_type_index</td>
        <td>指向字段描述符，CONSTANT_NameAndType</td>
    </tr>
    <tr>
  		 <td rowspan="3">CONSTANT_Methodref_info</td>
  		 <td rowspan="3">类中方法的符号引用</td>
         <td>u1</td>
         <td>tag</td>
  		 <td>10</td> 
    </tr>
    <tr>
        <td>u2</td>  
        <td>class_index</td>
        <td>指向声明字段的类或者接口描述符，CONSTANT_Class_info</td>
    </tr>
    <tr>
        <td>u2</td>  
        <td>name_and_type_index</td>
        <td>指向字段描述符，CONSTANT_NameAndType</td>
    </tr>
    <tr>
  		 <td rowspan="3">CONSTANT_InterfaceMethodref_info</td>
  		 <td rowspan="3">接口中方法的符号引用</td>
         <td>u1</td>
         <td>tag</td>
  		 <td>11</td> 
    </tr>
    <tr>
        <td>u2</td>  
        <td>class_index</td>
        <td>指向声明字段的类或者接口描述符，CONSTANT_Class_info</td>
    </tr>
    <tr>
        <td>u2</td>  
        <td>name_and_type_index</td>
        <td>指向字段描述符，CONSTANT_NameAndType</td>
    </tr>
    <tr>
  		 <td rowspan="3">CONSTANT_NameAndType_info</td>
  		 <td rowspan="3">字段或方法的部分符号引用</td>
         <td>u1</td>
         <td>tag</td>
  		 <td>12</td> 
    </tr>
    <tr>
        <td>u2</td>  
        <td>name_index</td>
        <td>指向该字段或方法名称，CONSTANT_utf8_info</td>
    </tr>
    <tr>
        <td>u2</td>  
        <td>descriptor_index</td>
        <td>指向该字段或方法描述符，CONSTANT_utf8_info</td>
    </tr>
    <tr>
  		 <td rowspan="3">CONSTANT_MethodHandle_info</td>
  		 <td rowspan="3">表示方法句柄</td>
         <td>u1</td>
         <td>tag</td>
  		 <td>15</td> 
    </tr>
    <tr>
        <td>u2</td>  
        <td>reference_kind</td>
        <td>方法句柄的类型，1-9</td>
    </tr>
    <tr>
        <td>u2</td>  
        <td>reference_index</td>
        <td>对常量池的有效索引，CONSTANT_utf8_info</td>
    </tr>
    <tr>
  		 <td rowspan="2">CONSTANT_MethodType_info</td>
  		 <td rowspan="2">标识方法类型</td>
         <td>u1</td>
         <td>tag</td>
  		 <td>16</td> 
    </tr>
    <tr>
        <td>u2</td>  
        <td>descriptor_index</td>
        <td>指向该字段或方法描述符，CONSTANT_utf8_info</td>
    </tr>
    <tr>
  		 <td rowspan="3">CONSTANT_InvokeDynamic_info</td>
  		 <td rowspan="3">动态方法调用点</td>
         <td>u1</td>
         <td>tag</td>
  		 <td>18</td> 
    </tr>
    <tr>
        <td>u2</td>  
        <td>bootstrap_method_attr_index</td>
        <td>对当前Class文件中引导方法表的bootstrap_methods[]数组的的有效索引</td>
    </tr>
    <tr>
        <td>u2</td>  
        <td>name_and_type_index</td>
        <td>方法名和方法描述符，CONSTANT_NameAndType</td>
    </tr>
</table>
