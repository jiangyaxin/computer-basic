# Class文件结构

class文件 使用 u1、u2、u4 表示1、2、4字节无符号整数，用table来表示数组对象，table由长度n+n个字节数组组成，一个字节数组就是一个对象。

```text
ClassFile {
    u4             magic;                                    //Class 文件的标志：魔数
    u2             minor_version;                            //Class 的次版本号
    u2             major_version;                            //Class 的主版本号
    u2             constant_pool_count;                      //常量池的数量
    cp_info        constant_pool[constant_pool_count-1];     //常量池
    u2             access_flags;                             //Class 的访问标志
    u2             this_class;                               //当前类
    u2             super_class;                              //父类
    u2             interfaces_count;                         //接口
    u2             interfaces[interfaces_count];             //一个类可以实现多个接口
    u2             fields_count;                             //Class 文件的字段属性
    field_info     fields[fields_count];                     //一个类会可以有个字段
    u2             methods_count;                            //Class 文件的方法数量
    method_info    methods[methods_count];                   //一个类可以有个多个方法
    u2             attributes_count;                         //此类的属性表中的属性数
    attribute_info attributes[attributes_count];             //属性表集合
}
```

`My Very Cute Animal Turns Savage In Full Moon Areas`
![438.png](assets/438.png)

## 常量池

常量池的索引从1开始，第0项是用于表示“不引用任何一个常量池项目”。

```text
cp_info {
    u1 tag;     // 常量项类型
    u1 info[];  // 字节数组
}
```

不同的常量类型字节数组布局不一样。

<table>
    <tr>
        <td>类型</td> 
        <td>tag</td> 
        <td>描述</td>
        <td>字段</td>
        <td>类型</td>
   </tr>
    <tr>
  		 <td>CONSTANT_utf8_info</td> 
  		 <td>1</td> 
  		 <td rowspan="3">MUTF8编码的字符串</td>
         <td>tag</td> 
         <td>u1</td>
    </tr>
    <tr>
        <td>length</td> 
        <td>u2</td>    
    </tr>
    <tr>
        <td>byte[length]</td> 
        <td>u1</td>    
    </tr>
</table>

| 类型                               | tag | 长度                                                                           |
|----------------------------------|-----|------------------------------------------------------------------------------|
| CONSTANT_utf8_info               | 1   | 不定长，info[]的前两个字节描述长度                                                         |
| CONSTANT_Integer_info            | 3   | 4个字节                                                                         |
| CONSTANT_Float_info              | 4   | 4个字节                                                                         | 
| CONSTANT_Long_info               | ５   | 8个字节                                                                         | 
| CONSTANT_Double_info             | ６   | 8个字节                                                                         |
| CONSTANT_Class_info              | ７   | 2个字节，指向utf8                                                                  |
| CONSTANT_String_info             | ８   | 2个字节，指向utf8                                                                  |
| CONSTANT_Fieldref_info           | ９   | 4个字节，2个字节，指向class，2个字节，指向 NameAndType                                        |
| CONSTANT_Methodref_info          | 10  | 4个字节，2个字节，指向class，2个字节，指向 NameAndType                                        |
| CONSTANT_InterfaceMethodref_info | 11  | 4个字节，2个字节，指向class，2个字节指向 NameAndType                                         |
| CONSTANT_NameAndType_info        | 12  | 4个字节，2个字节表示名字，指向utf8，2个字节表示描述符，指向utf8字段                                      |
| CONSTANT_MothodType_info         | 16  | 4个字节，2个字节表示引导方法，指向bootstrap_method[],2个字节，指向 NameAndType                     |
| CONSTANT_MethodHandle_info       | 15  | 4个字节，2个字节表示引导方法，指向bootstrap_method[],2个字节，指向 NameAndType                     |
| CONSTANT_InvokeDynamic_info      | 18  | 4个字节，2个字节表示为 invokedynamic 指令提供引导方法，指向bootstrap_method[],2个字节，指向 NameAndType | 
