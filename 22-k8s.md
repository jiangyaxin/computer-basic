# K8S教程

本次学习教程采用的是5台服务器, 1台为master节点, 2台为node节点, 1台为Harbor私有docker仓库, 1台为koolshare软路由器服务器(这个暂时不讲, 主要是科学上网使用), 本次前4台都是采用CentOS-7-x86_64-Minimal-1810.iso的镜像, 安装过程不在这里描述, 每个服务器的虚拟配置如下:

| 服务器                  | 内存 | 处理器 | 硬盘  | 网络适配器     | ip            |
| ----------------------- | ---- | ------ | ----- | -------------- | ------------- |
| k8s-master01            | 4GB  | 4核    | 100GB | 仅主机模式     | 192.168.66.10 |
| k8s-node01              | 4GB  | 4核    | 100GB | 仅主机模式     | 192.168.66.20 |
| k8s-node02              | 4GB  | 4核    | 100GB | 仅主机模式     | 192.168.66.21 |
| Harbor                  | 2GB  | 2核    | 100GB | 仅主机模式     | 192.168.66.31 |
| koolshare(可以不用部署) | 1GB  | 1核    | 100GB | 仅主机模式,NAT | 192.168.66.1  |

注:

1.VMware启动虚拟机一直处于黑屏, 原因如下: 

```java
问题：在VMware中装了虚拟机，但是在启动后一直处于黑屏而无法进入系统，也没有报错提示，出现这种问题的主要原因是VMware软件跟本地网路规范有所冲突，解决办法也简单，重置一下网络规范就好了，具体的操作方法如下：
方法1:在重启电脑，在设置中将打印机移除，然后启动虚拟机解决
方法2：以管理员身份运行命令行窗口---->输入 netsh winsock reset，然后重启计算机。
方法3：VM->Settings->Hardware->Display在右面的内容栏中将Accelerate 3D graphics 取消打勾，然后重启即可
```

2.修改服务器IP:
   vim /etc/sysconfig/network-scripts/ifcfg-ens33

```shell
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.66.20
NETMASK=255.255.255.0
GATEWAY=192.168.66.1
DNS1=192.168.66.1
DNS2=114.114.114.114
```

## 同步时间

手动同步时间

```shell
ntpdate -u cn.pool.ntp.org
```

配置定时任务，同步时间

```shell
crontab -e
# 每过半个小时同步一次
0 */30 * * * /usr/sbin/ntpdate -u cn.pool.ntp.org > /dev/null 2>&1; /sbin/hwclock -w
```

配置开启启动同步时间

编辑/etc/rc.d/rc.local文件(`vim /etc/rc.d/rc.local`),在文件末尾添加如下内容

```shell
/usr/sbin/ntpdate -u cn.pool.ntp.org> /dev/null 2>&1; /sbin/hwclock -w
```

## 修改hostname

查看系统hostname:

hostnamectl status

设置系统hostname:

hostnamectl set-hostname  [hostname]

修改系统hosts文件:

vim /etc/hosts

输入内容:

```shell
192.168.66.10  k8s-master01
192.168.66.20  k8s-node01
192.168.66.21  k8s-node02
```

重启network:

```shell
service network restart
```

## 安装docker

安装方式有3种方式:

script install:

```shell
yum update
curl -sSL https://get.docker.com/ | sh systemctl start docker
systemctl enable docker docker run hello-world
```

yum install:

```shell
yum remove docker docker-common docker-selinux docker-engine
yum install -y yum-utils device-mapper-persistent-data lvm2
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum -y install docker-ce
设置为开机启动
systemctl enable docker
启动
systemctl start docker
查看启动状态
systemctl status docker
查看版本
docker version
```

RPM install:

```shell
https://download.docker.com/linux/centos/7/x86_64/stable/Packages/
```

